# Generic Policy Decorator Generator

A C# source generator that generates a universal decorator.
Primary use-case is for decoration that does not depend on any method-specific context, e. g. to decorate each interface method with a retry on exceptions.

## Usage

```csharp
// The developer-provided partial class declares the interfaces to implement/decorate, and has the GenericDecorator attribute
[GenericDecorator]
partial class MyFooDecorator(IFoo inner) : IFoo
{
    // for each declared interface, implement a method to get an instance implementing that interface
    // the method will be used by the generated decoration
    private partial IFoo GetInnerIFoo() => inner;

    // implement four universal decoration methods,
    // one for each combination of sync/async and return/void

    private partial void Decorate(Action doInner)
    {
        // do other stuff
        doInner();
    }

    private partial T Decorate(Func<T> doInner)
    {
        // do other stuff
        return doInner();
    }

    private partial Task DecorateAsync(Func<Task> doInner)
    {
        // do other stuff
        return doInner();
    }

    private partial Task<T> DecorateAsync(Func<Task<T>> doInner)
    {
        // do other stuff
        return doInner();
    }
}
```

This source generator complements the developer-provided class with the boilerplate of wrapping each inner implementation method in a call to the appropriate universal decoration method.

Like this (not necessarily the exact generated code):

```csharp
// assume this interface
interface IFoo
{
    void DoStuff();
    Task<string> GetStuffAsync(int arg1, string arg2);
}

// <auto-generated />
partial class MyFooDecorator
{
    // (omitted) partial declarations of the necessary methods

    void IFoo.DoStuff() => Decorate(() => inner.DoStuff());

    Task<string> IFoo.GetStuffAsync(int arg1, string arg2) => DecorateAsync(() => inner.GetStuffAsync(arg1, arg2));
}
```
